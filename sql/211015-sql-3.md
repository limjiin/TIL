1. ì„œë¸Œì¿¼ë¦¬ ê°œë… ì¡ê¸°
- ì„œë¸Œì¿¼ë¦¬ë€? SQL ë¬¸ì¥ ì•ˆì— í¬í•¨ë˜ëŠ” ë˜ ë‹¤ë¥¸ SQL ë¬¸ì¥ì„ ì˜ë¯¸
- FROMì ˆì˜ ì„œë¸Œì¿¼ë¦¬ : ì¡°ê±´ì— ë§ëŠ” ëŒ€ìƒì„ ì„ íƒí•œ í›„ ìš”ì•½(í•„í„°ë§)í•  ë•Œ ì‚¬ìš©
--  SELECT ì»¬ëŸ¼ëª…1, ì»¬ëŸ¼ëª…2
    FROM
    (
        SELECT *
        FROM í…Œì´ë¸”ëª…
    ) ë³„ì¹­
    WHERE ì¡°ê±´ì ˆ

# ì…‹íŒ…
show databases;
use world;
select * from country;

# ë¬¸ì œ
select a.continent, avg(a.gnp) as avg_gnp
from
	(
		select continent, name, gnp
		from country
		where continent = 'Asia'
		order by gnp desc
		limit 5
	) a
group by continent
;

- WHERE ì ˆì˜ ì„œë¸Œì¿¼ë¦¬ : íŠ¹ì • í…Œì´ë¸”ì—ì„œ ì¶”ì¶œëœ ëª¨ë“  ë°ì´í„°ê°€ ì¡°ê±´ì ˆì— ì‚¬ìš©ë¨

SELECT name FROM country WHERE name LIKE '%Korea%
= SELECT name FROM country WHERE name IN (â€˜South Koreaâ€™, â€˜North Koreaâ€™) 
= SELECT name FROM country WHERE name IN ( SELECT name FROM country WHERE name LIKE '%Korea%')

# ë¬¸ì œ
select continent, name
from country
where code in  
(
	select countrycode
	from countrylanguage
	group by countrycode
	having count(*) >= 12 
)
;

2. í…Œì´ë¸” í•©ì¹˜ê¸° ê°œë… ì´í•´
- SQL JOIN
ë‘ ê°œ ì´ìƒì˜ í…Œì´ë¸” ë“¤ì„ ì—°ê²° ë˜ëŠ” ê²°í•©í•˜ì—¬ ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ëŠ” ê²ƒì„ JOIN ì´ë¼ê³  í•¨
ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ê°€ì¥ í° ì¥ì ì´ JOIN ì„
FROM ì ˆì— ì—¬ëŸ¬ ê°œì˜ í…Œì´ë¸”ì´ ë‚˜ì—´ë˜ë”ë¼ë„, ì‹¤ì œ ì²˜ë¦¬ ì‹œ ë‘ê°œì˜ í…Œì´ë¸” ë§Œ ì¡°ì¸ë¨
ì˜ˆë¥¼ ë“¤ì–´ A, B, C, D 4ê°œì˜ í…Œì´ë¸”ì„ ì¡°ì¸í•˜ê³ ì í•  ê²½ìš° ì¿¼ë¦¬ ì˜µí‹°ë§ˆì´ì €ëŠ” ( ( (A JOIN D) JOIN C) JOIN B)ì™€ ê°™ì´ ìˆœì°¨ì ìœ¼ë¡œ ì¡°ì¸ì„ ì²˜ë¦¬í•˜ê²Œ ë¨

- JOIN ì˜ ë°©ë²•ê³¼ ë°©ì‹
ì¡°ì¸ì˜ ë°©ë²• : Equi Join (ë“±ê°€ ì¡°ì¸, ë‚´ë¶€ì¡°ì¸) , Non-Equi Join , Self Join , Outer Join
ì¡°ì¸ì˜ ë°©ì‹ : Nested Loop Join, Sort Merge Join, Hash Join

- ì»¬ëŸ¼ í•©ì¹˜ê¸° = SQLì˜ VLOOKUP ê¸°ëŠ¥ê³¼ ìœ ì‚¬í•¨

- ë¡œìš° í•©ì¹˜ê¸° : ê°™ì€ ì˜ë¯¸ì˜ ì»¬ëŸ¼ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” ì„œë¡œ ë‹¤ë¥¸ í…Œì´ë¸”ì„ í•˜ë‚˜ì˜ í…Œì´ë¸”ë¡œ í•©ì¹˜ëŠ” ê²½ìš°

- ë‚´ë¶€ ì¡°ì¸ ì‚¬ìš© ë°©ë²•

ë‚´ë¶€ ì¡°ì¸ì€ í…Œì´ë¸” ê°„ì˜ êµì§‘í•©ì„ êµ¬í•˜ëŠ” ë°©ì‹

-- WHERE ì¡°ê±´ì„ ì´ìš©í•œ JOIN
SELECT PLAYER.PLAYER_NAME
, PLAYER.BACK_NO
, PLAYER.TEAM_ID
, TEAM.TEAM_NAME
, TEAM.REGION_NAME
FROM PLAYER, TEAM
WHERE PLAYER.TEAM_ID = TEAM.TEAM_ID;

-- INNER JOIN ì„ ì´ìš©í•œ JOIN
SELECT PLAYER.PLAYER_NAME
, PLAYER.BACK_NO
, PLAYER.TEAM_ID
, TEAM.TEAM_NAME
, TEAM.REGION_NAME
FROM PLAYER
INNER JOIN TEAM
ON PLAYER.TEAM_ID = TEAM.TEAM_ID;

ë³„ì¹­ì„ ì‚¬ìš©í•˜ì—¬ ì¡°ì¸í•  ìˆ˜ ìˆë‹¤.

-- WHERE ì¡°ê±´ì„ ì´ìš©í•œ JOIN
SELECT A.PLAYER_NAME
, A.BACK_NO
, A.TEAM_ID
, B.TEAM_NAME
, B.REGION_NAME
FROM PLAYER A, TEAM B
WHERE A.TEAM_ID = B.TEAM_ID ;

-- ON ì ˆì„ ì´ìš©í•œ JOIN
SELECT A.PLAYER_NAME
, A.BACK_NO
, A.TEAM_ID
, B.TEAM_NAME
, B.REGION_NAME
FROM PLAYER A
INNER JOIN TEAM B
ON A.TEAM_ID = B.TEAM_ID

í•„í„° ì¡°ê±´ ë° ì •ë ¬ì„ í•¨ê»˜ ì‚¬ìš©í•œ ì¡°ì¸ ì˜ˆì œ

-- WHERE ì¡°ê±´ JOIN
SELECT A.PLAYER_NAME
, A.BACK_NO
, A.TEAM_ID
, B.TEAM_NAME
, B.REGION_NAME
FROM PLAYER A, TEAM B
WHERE A.TEAM_ID = B.TEAM_ID
AND A.POSITION = 'GK'
ORDER BY A.BACK_NO ;

-- ON ì ˆì„ ì‚¬ìš©í•œ JOIN
SELECT A.PLAYER_NAME
, A.BACK_NO
, A.TEAM_ID
, B.TEAM_NAME
, B.REGION_NAME
FROM PLAYER A
INNER JOIN TEAM B
[OON A.TEAM_ID = B.TEAM_ID
WHERE A.POSITION = 'GK'
ORDER BY A.BACK_NO ;

3. EQUI-JOIN ê³¼ NON EQUI-JOINì˜ ì´í•´
- Equal ì¡°ì¸ì´ë¼ê³  í•˜ê¸°ë„ í•˜ë©°, ì¡°ì¸ ì¤‘ì—ì„œë„ ê°€ì¥ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” Equality Condition(=) ì— ì˜í•œ ì¡°ì¸
- Equi-JOIN ì˜ ì„±ëŠ¥ì„ ë†’ì´ê¸° ìœ„í•´ì„œëŠ”, ì¡°ì¸ì˜ ì¡°ê±´ ì»¬ëŸ¼ì— ëŒ€í•´ ì¸ë±ìŠ¤ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

# WHERE ì ˆì— JOIN ì¡°ê±´ì„ ë„£ëŠ” ë°©ì‹
SELECT í…Œì´ë¸”1.ì¹¼ëŸ¼ëª…, í…Œì´ë¸”2.ì¹¼ëŸ¼ëª…, ...
FROM í…Œì´ë¸”1, í…Œì´ë¸”2
WHERE í…Œì´ë¸”1.ì¹¼ëŸ¼ëª…1 = í…Œì´ë¸”2.ì¹¼ëŸ¼ëª…2;

# ON ì ˆì— JOIN ì¡°ê±´ì„ ë„£ëŠ” ë°©ì‹ (ANSI í‘œì¤€)
SELECT í…Œì´ë¸”1.ì¹¼ëŸ¼ëª…, í…Œì´ë¸”2.ì¹¼ëŸ¼ëª…, ...
FROM í…Œì´ë¸”1
INNER JOIN í…Œì´ë¸”2
ON í…Œì´ë¸”1.ì¹¼ëŸ¼ëª…1 = í…Œì´ë¸”2.ì¹¼ëŸ¼ëª…2

# ë¬¸ì œ
select countrylanguage.*, country.name
from countrylanguage, country
where  countrylanguage.countrycode = country.code
;

# ë¬¸ì œ2
select a.*, b.name
from countrylanguage a
inner join country b
on a.countrycode = b.code
;

- NON-EQUI-JOIN ì´ë€?
Equal(=) ì—°ì‚°ìê°€ ì•„ë‹Œ ë‹¤ë¥¸ (BETWEEN, >=, <=, >, < ë“±) ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°ì¸ì„ ìˆ˜í–‰í•œë‹¤.
BETWEEN AND, IS NULL, IS NOT NULL, IN, NOT IN
ì„±ëŠ¥ì´ ì¢‹ì§€ ì•Šìœ¼ë©°, ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ìœ í˜•

4. JOINì˜ ìœ í˜•

- ìì£¼ ì“°ëŠ” ì¡°ì¸ì˜ ìœ í˜•
(INNER) JOIN
LEFT (OUTER) JOIN
RIGHT (OUTER) JOIN
FULL (OUTER) JOIN

- INNER JOIN(INNER ìƒëµê°€ëŠ¥) : JOIN êµ¬ë¬¸ì˜ ì¡°ê±´ì´ A ì™€ B í…Œì´ë¸” ì–‘ìª½ í…Œì´ë¸”ì— ì¼ì¹˜í•˜ëŠ” ê²°ê³¼, ì‰½ê²Œ ë§í•´ êµì§‘í•©ì„ êµ¬í•¨

select * from table a
inner join table b
on table a.name = table b.name

- LEFT OUTER JOIN(OUTER ìƒëµê°€ëŠ¥)

ì™¼ìª½ í…Œì´ë¸”ì„ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¥¸ìª½ í…Œì´ë¸”ì˜ JOIN ì¡°ê±´ì— ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ë¥¼ ì¶œë ¥

select * from table a
left outer join table b
on table a.name = table b.name

ì¡°ê±´ì ˆì„ í†µí•´ Aí…Œì´ë¸”ì—ë§Œ ì¡´ì¬í•˜ëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŒ(ì°¨ì§‘í•©)

select * from table a
left outer join table b
on table a.name = table b.name
where table b.id is null

- FULL OUTER JOIN
í…Œì´ë¸” A ì™€ B ì˜ í•©ì§‘í•©ì„ êµ¬í•˜ëŠ” JOIN

select * from table a
full outer join table b
on table a.name = table b.name

ì¡°ê±´ì ˆì„ í™œìš©í•˜ì—¬ ê°ê°ì˜ í…Œì´ë¸”ì—ë§Œ ì¡´ì¬í•˜ëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŒ

select * from table a
full outer join table b
on table a.name = table b.name
where table a.id is null
or table b.id is null

4. JOIN ì‹¤ìŠµì„ ìœ„í•œ í…Œì´ë¸” ìƒì„±í•˜ê¸°

# ë°ì´í„° ë² ì´ìŠ¤ ìƒì„±í•˜ê¸°
CREATE DATABASE fastcampus;

USE fastcampus;

# ê¸°ì¡´ student í…Œì´ë¸”ì´ ìˆë‹¤ë©´ ì‚­ì œí•˜ê¸°
DROP TABLE IF EXISTS `student`;

# student í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ìƒì„±í•˜ê¸°
CREATE TABLE `student` (
`id` tinyint(4) NOT NULL,
`name` char(8) NOT NULL,
`sex` enum('ë‚¨ì','ì—¬ì') NOT NULL,
`location_id` tinyint(4) NOT NULL,
`birthday` datetime NOT NULL,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

# location í…Œì´ë¸”ì´ ìˆë‹¤ë©´ ì‚­ì œí•˜ê¸°
DROP TABLE IF EXISTS `location`;

# location í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ìƒì„±í•˜ê¸°
CREATE TABLE `location` (
`id` tinyint UNSIGNED NOT NULL AUTO_INCREMENT ,
`name` varchar(20) NOT NULL ,
`distance` tinyint UNSIGNED NOT NULL ,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

# student í…Œì´ë¸” ìƒ˜í”Œ ë°ì´í„° ì‚½ì…
INSERT INTO `student` VALUES (1, 'ì´ìˆ™ê²½', 'ì—¬ì', 1, '1982-11-16 00:00:00');
INSERT INTO `student` VALUES (2, 'ë°•ì¬ìˆ™', 'ë‚¨ì', 2, '1985-10-26 00:00:00');
INSERT INTO `student` VALUES (3, 'ë°±íƒœí˜¸', 'ë‚¨ì', 3, '1989-2-10 00:00:00');
INSERT INTO `student` VALUES (4, 'ê¹€ê²½í›ˆ', 'ë‚¨ì', 4, '1979-11-4 00:00:00');
INSERT INTO `student` VALUES (6, 'ê¹€ê²½ì§„', 'ì—¬ì', 5, '1985-1-1 00:00:00');
INSERT INTO `student` VALUES (7, 'ë°•ê²½í˜¸', 'ë‚¨ì', 6, '1981-2-3 00:00:00');
INSERT INTO `student` VALUES (8, 'ê¹€ì •ì¸', 'ë‚¨ì', 5, '1990-10-1 00:00:00');

# location í…Œì´ë¸” ìƒ˜í”Œ ë°ì´í„° ì‚½ì…
INSERT INTO `location` VALUES (1, 'ì„œìš¸', 10);
INSERT INTO `location` VALUES (2, 'ì²­ì£¼', 200);
INSERT INTO `location` VALUES (3, 'ê²½ì£¼', 255);
INSERT INTO `location` VALUES (4, 'ì œì²œ', 190);
INSERT INTO `location` VALUES (5, 'ëŒ€ì „', 200);
INSERT INTO `location` VALUES (6, 'ì œì£¼', 255);
INSERT INTO `location` VALUES (7, 'ì˜ë™', 255);
INSERT INTO `location` VALUES (8, 'ê´‘ì£¼', 255);

# í…Œì´ë¸” í™•ì¸í•˜ê¸°
select * from location;
select * from student;

5. JOIN ì‘ì„± ë°©ë²• ì‘ìš© ë° ì‹¤ìŠµ

- ì„œë¸Œì¿¼ë¦¬ë¥¼ í™œìš©í•œ JOIN ì‘ì„± ë°©ì‹ : ì„œë¸Œì¿¼ë¦¬ ì‘ì„± ë°©ì‹ì„ í™œìš©í•˜ì—¬ ì¡°ì¸ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ë©´, ì¿¼ë¦¬ê°€ ê¸¸ì–´ì§€ëŠ” ë‹¨ì ì´ ìˆì§€ë§Œ ì¿¼ë¦¬ì˜ ê°€ë…ì„±ê³¼ ì¬ì‚¬ìš©ì„±ì´ ë†’ì•„ì§(ì´ˆì‹¬ìì—ê²Œ íŠ¹íˆ ê¶Œì¥

SELECT P.PLAYER_NAME ì„ ìˆ˜ëª…
, P.POSITION í¬ì§€ì…˜
, T.REGION_NAME ì—°ê³ ì§€
, T.TEAM_NAME íŒ€ëª…
, S.STADIUM_NAME êµ¬ì¥ëª…
FROM PLAYER P
INNER JOIN TEAM T
ON P.TEAM_ID = T.TEAM_ID
INNER JOIN STADIUM S
ON T.STADIUM_ID = S.STADIUM_ID
ORDER BY ì„ ìˆ˜ëª…;

SELECT P.PLAYER_NAME ì„ ìˆ˜ëª…
, P.POSITION í¬ì§€ì…˜
, T.REGION_NAME ì—°ê³ ì§€
, T.TEAM_NAME íŒ€ëª…
, S.STADIUM_NAME êµ¬ì¥ëª…
FROM
(
SELECT * FROM PLAYER
) P
INNER JOIN
(
SELECT *
FROM TEAM
) T
ON P.TEAM_ID = T.TEAM_ID
INNER JOIN
(
SELECT *
FROM STADIUM
) S
ON T.STADIUM_ID = S. STADIUM_ID
ORDER BY ì„ ìˆ˜ëª…;

# ë¬¸ì œ
select s.location_id, s.name, l.id, l.distance
from student as s
inner join location as l
on s.location_id = l.id;

# ë¬¸ì œ
select a.*, b.*
from
(
	select *
	from student
) as a
inner join
# left outer join : inner joinê³¼ ë˜‘ê°™ì€ ê°’ìœ¼ë¡œ ë‚˜ì˜´
# right outer join : null ê°’ì´ ë‚˜ì˜´
(
	select *
	from location
) as b
on a.location_id = b.id
;

# ë¬¸ì œ
delete from location where name = 'ì œì£¼';

select * from location;

# ë¬¸ì œ
select a.continent, a.name
		, b.cnt as city_cnt
from
(
select code, continent, name
from country
where continent = 'Asia'
) as a
join
(
select countrycode, count(*) as cnt
from city
group by countrycode
having cnt > 50
) as b
on a.code = b.countrycode
order by cnt desc
;

# ë¬¸ì œ
select b.name as name, b.population, a.name as Name, c.lang
from
(
select code, name
from country
) as a
join
(
select countrycode, name, population
from city
order by population desc
limit 5
) as b
on a.code = b.countrycode
join
(
select countrycode, group_concat(language order by percentage desc) as lang
from countrylanguage
group by countrycode
) as c
on a.code = c.countrycode
;

6. í–‰ í•©ì¹˜ê¸°
- UNION ì—°ì‚°ìë¥¼ ì´ìš©í•œ í–‰ í•©ì¹˜ê¸°
ë‘ ê°œ ì´ìƒ í…Œì´ë¸”ì˜ SELECT ê²°ê³¼í–‰ì„ í•©ì¹  ë•Œ UNION ì—°ì‚°ì í™œìš©
A í…Œì´ë¸”, B í…Œì´ë¸”ì„ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” SQL ë¬¸ë²•ì„ ì „ë¶€ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
UNION ìœ¼ë¡œ í•©ì³ì§€ëŠ” SELECT ë¬¸ì˜ ì»¬ëŸ¼ ìˆ«ìê°€ ë™ì¼í•´ì•¼ í•¨
í•©ì³ì§€ëŠ” ì»¬ëŸ¼ì˜ ë°ì´í„° ìœ í˜•ì´ ë™ì¼í•´ì•¼ í•¨
ì¤‘ë³µì´ ìˆëŠ” ë°ì´í„°ëŠ” í•˜ë‚˜ë§Œ í‘œí˜„ í•¨
í•©ì³ì§„ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ëª…ì€ LEFT TABLE ì˜ ì»¬ëŸ¼ëª…
í•©ì³ì§„ ë°ì´í„°ì˜ ì¤‘ë³µì„ ì œê±°í•˜ì§€ ì•Šê¸° ìœ„í•´ì„œëŠ” UNION ALL ì„ ì‚¬ìš©

SELECT ì»¬ëŸ¼ëª…1, ì»¬ëŸ¼ëª…2 FROM í…Œì´ë¸”1
UNION
SELECT ì»¬ëŸ¼ëª…3, ì»¬ëŸ¼ëª…4 FROM í…Œì´ë¸”2
ORDER BY 1

# ì„œë¸Œì¿¼ë¦¬ ì•ˆì—ëŠ” ê°™ì€ ì¡°ê±´ì„ ë„£ì–´ì¤˜ì•¼ ì¤‘ë³µì´ ì œê±°ë˜ì–´ ë‚˜ì˜´.
# ì¿¼ë¦¬ ë°–ì—ì„œ ì¡°ê±´ì„ ì£¼ë©´ ì„œë¹„ ì¿¼ë¦¬ì— ë”°ë¡œ ì¡°ê±´ì ˆì„ ì£¼ì§€ ì•Šì•„ë„ ë¨.
select count(*) as cnt
from
(
select code from country # where code = 'ABW' -- 1
union -- ì¤‘ë³µì„ í—ˆìš©í•˜ì§€ ì•ŠìŒ
select countrycode from city # where countrycode = 'ABW' -- 4079
) a
where a.code = 'ABW'
;

# ê°™ì€ ì—´ë¡œ í•©ì¹˜ê¸° ê°€ëŠ¥í•¨
select *
from
(
select code, continent from country
union
select countrycode, name from city
) a
where code = 'ABW'
;

# ì •ë ¬ ì‰½ê²Œ ë³´ê¸°
select code from country
union
select countrycode from city
order by 1 desc;

